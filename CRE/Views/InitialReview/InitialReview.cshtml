@model CRE.ViewModels.InitialReviewListViewModel

@{
    ViewData["Title"] = "Initial Review Applications";
}

<h2>Initial Review Applications</h2>

<!-- Nav tabs -->
<ul class="nav nav-tabs" id="myTab" role="tablist">
    <li class="nav-item">
        <a class="nav-link active" id="pending-tab" data-toggle="tab" href="#pending" role="tab" aria-controls="pending" aria-selected="true">Pending for Evaluation</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" id="approved-tab" data-toggle="tab" href="#approved" role="tab" aria-controls="approved" aria-selected="false">Approved for Evaluation</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" id="returned-tab" data-toggle="tab" href="#returned" role="tab" aria-controls="returned" aria-selected="false">Returned Applications</a>
    </li>
</ul>

<!-- Tab content -->
<div class="tab-content" id="myTabContent">
    <!-- Pending for Evaluation Tab -->
    <div class="tab-pane fade show active" id="pending" role="tabpanel" aria-labelledby="pending-tab">
        <table class="table table-bordered mt-3">
            <thead>
                <tr>
                    <th>Urec No</th>
                    <th>Title</th>
                    <th>Submission Date</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                @if (Model.PendingApplications == null || !Model.PendingApplications.Any())
                {
                    <tr>
                        <td colspan="4" class="text-center">No pending applications found.</td>
                    </tr>
                }
                else
                {
                    foreach (var application in Model.PendingApplications)
                    {
                        <tr>
                            <td>
                                <!-- Make urecNo a clickable button that leads to the Details page -->
                                <a asp-action="Details" asp-route-urecNo="@application.EthicsApplication?.urecNo" class="btn btn-primary">
                                    @application.EthicsApplication?.urecNo
                                </a>
                            </td>
                            <td>@application.NonFundedResearchInfo?.title</td>
                            <td>@application.EthicsApplication?.submissionDate.ToShortDateString()</td>
                            <td>@application.EthicsApplicationLog.FirstOrDefault()?.status</td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>

    <!-- Approved for Evaluation Tab -->
    <div class="tab-pane fade" id="approved" role="tabpanel" aria-labelledby="approved-tab">
        <table class="table table-bordered mt-3">
            <thead>
                <tr>
                    <th>Urec No</th>
                    <th>Title</th>
                    <th>Status</th>
                    <th>Submission Date</th>
                </tr>
            </thead>
            <tbody>
                @if (Model.ApprovedApplications == null || !Model.ApprovedApplications.Any())
                {
                    <tr>
                        <td colspan="4" class="text-center">No approved applications found.</td>
                    </tr>
                }
                else
                {
                    foreach (var application in Model.ApprovedApplications)
                    {
                        <tr>
                            <td>
                                <!-- Make urecNo a clickable button that leads to the Details page -->
                                <a asp-action="Details" asp-route-urecNo="@application.EthicsApplication?.urecNo" class="btn btn-link">
                                    @application.EthicsApplication?.urecNo
                                </a>
                            </td>
                            <td>@application.NonFundedResearchInfo?.title</td>
                            <td>@application.EthicsApplicationLog.FirstOrDefault()?.status</td>
                            <td>@application.EthicsApplication?.submissionDate.ToShortDateString()</td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>

    <!-- Returned Applications Tab -->
    <div class="tab-pane fade" id="returned" role="tabpanel" aria-labelledby="returned-tab">
        <table class="table table-bordered mt-3">
            <thead>
                <tr>
                    <th>Urec No</th>
                    <th>Title</th>
                    <th>Submission Date</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                @if (Model.ReturnedApplications == null || !Model.ReturnedApplications.Any())
                {
                    <tr>
                        <td colspan="4" class="text-center">No returned applications found.</td>
                    </tr>
                }
                else
                {
                    foreach (var application in Model.ReturnedApplications)
                    {
                        <tr>
                            <td>
                                <!-- Make urecNo a clickable button that leads to the Details page -->
                                <a asp-action="Details" asp-route-urecNo="@application.EthicsApplication?.urecNo" class="btn btn-primary">
                                    @application.EthicsApplication?.urecNo
                                </a>
                            </td>
                            <td>@application.NonFundedResearchInfo?.title</td>
                            <td>@application.EthicsApplication?.submissionDate.ToShortDateString()</td>
                            <td>@application.EthicsApplicationLog.FirstOrDefault()?.status</td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            // Activate Bootstrap tab functionality
            $('#myTab a').on('click', function (e) {
                e.preventDefault();
                $(this).tab('show');
            });
        });
    </script>
}
